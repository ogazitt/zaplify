var DataModel=function DataModel$(){};DataModel.Constants={};DataModel.User={};DataModel.Folders={};DataModel.Suggestions={};DataModel.UserSettings;DataModel.onDataChangedHandlers={};DataModel.timeStamp="/Date(0)/";DataModel.Init=function DataModel$Init(c,d){this.processConstants($.parseJSON(c));this.processUserData($.parseJSON(d))};DataModel.Close=function DataModel$Close(){Service.Close();DataModel.UserSettings.Save()};DataModel.AddDataChangedHandler=function(d,c){this.onDataChangedHandlers[d]=c};DataModel.RemoveDataChangedHandler=function(b){delete this.onDataChangedHandlers[b]};DataModel.Refresh=function DataModel$Refresh(d){var c=DataModel.UserSettings.ViewState;Service.GetResource(Service.UsersResource,null,function(a){DataModel.processUserData(a.result);DataModel.UserSettings.ViewState=c;DataModel.restoreSelection()})};DataModel.FindItem=function DataModel$FindItem(f){if(f!=null){var d=DataModel.Folders[f];if(d!=null){return d}for(id in DataModel.Folders){d=DataModel.Folders[id];var e=d.Items[f];if(e!=null){return e}}}return null};DataModel.FindLocation=function DataModel$FindLocation(g,l){for(id in DataModel.Folders){var h=DataModel.Folders[id];if(h.ItemTypeID==ItemTypes.Location){for(id in h.Items){var i=h.Items[id];if(i.ItemTypeID==ItemTypes.Location){var k=i.GetFieldValue(FieldNames.LatLong);if(l!=null&&k!=null){if(l==k){return i}}else{var j=i.GetFieldValue(FieldNames.Address);if(g==j){return i}}}}}}return null};DataModel.FindContact=function DataModel$FindContact(j,f){for(id in DataModel.Folders){var g=DataModel.Folders[id];if(g.ItemTypeID==ItemTypes.Contact){for(id in g.Items){var h=g.Items[id];if(h.ItemTypeID==ItemTypes.Contact){var i=h.GetFieldValue(FieldNames.FacebookID);if(f!=null&&i!=null){if(f==i){return h}}else{if(j==h.Name){return h}}}}}}return null};DataModel.GetItems=function DataModel$GetItems(j,n,h){var m={};var i=(typeof(j)=="object")?j:DataModel.Folders[j];if(i!=undefined){if(h!=true){for(var k in i.Items){var l=i.Items[k];if(l.ParentID==n&&l.IsList){m[k]=i.Items[k]}}}for(var k in i.Items){var l=i.Items[k];if(l.ParentID==n&&!l.IsList){m[k]=i.Items[k]}}}return m};DataModel.InsertItem=function DataModel$InsertItem(q,m,k,n,j,l){if(q!=null&&q.Name!=null){var r=Service.ItemsResource;if(m==null){r=Service.FoldersResource}else{if(m.IsFolder()){q.FolderID=m.ID;q.ParentID=null;q.ItemTypeID=(q.ItemTypeID==null)?m.ItemTypeID:q.ItemTypeID}else{if(m.IsList!=null&&m.IsList){q.FolderID=m.FolderID;q.ParentID=m.ID;q.ItemTypeID=(q.ItemTypeID==null)?m.ItemTypeID:q.ItemTypeID}else{return false}}}if(k==null){if(m==null){var o=DataModel.FoldersMap.itemAt(-1);q.SortOrder=(o==null)?1000:o.SortOrder+1000}else{var p=ItemMap.itemAt(m.GetItems(),-1);q.SortOrder=(p==null)?1000:p.SortOrder+1000}}if(q.ID==null){q.ID=Math.uuid()}delete q.Created;if(m==null){q=DataModel.addFolder(q,j)}else{m.addItem(q,j)}Service.InsertResource(r,q,function(b){var a=b.result;q.update(a,null);if(l!=null){l(a)}});return true}return false};DataModel.InsertFolder=function DataModel$InsertFolder(f,d,e){return DataModel.InsertItem(f,null,d,e)};DataModel.UpdateItem=function DataModel$UpdateItem(h,j,f){if(h!=null&&j!=null){h.update(j,f);j.LastModified=DataModel.timeStamp;var i=(h.IsFolder())?Service.FoldersResource:Service.ItemsResource;var g=[h,j];if(i==Service.FoldersResource){g=[h.Copy(),j]}Service.UpdateResource(i,h.ID,g,function(a){var b=a.result;var c=h.update(b,null)});return true}return false};DataModel.DeleteItem=function DataModel$DeleteItem(l,j){if(l!=null){if(l.IsFolder()){DataModel.FoldersMap.remove(l);DataModel.fireDataChanged()}else{var o=l.GetParent();if(o!=null&&o.ItemTypeID==ItemTypes.Reference){l.GetFolder().ItemsMap.remove(l)}else{if(j!=null){var i=j.IsFolder()?j.ID:j.FolderID;var k=j.IsFolder()?null:j.ID;l.GetFolder().ItemsMap.remove(l);DataModel.deleteReferences(l.ID);DataModel.fireDataChanged(i,k)}else{var m=l.selectNextItem();var n=(m==null)?null:m.ID;l.GetFolder().ItemsMap.remove(l);DataModel.deleteReferences(l.ID);DataModel.fireDataChanged(l.FolderID,n)}}}var p=(l.IsFolder())?Service.FoldersResource:Service.ItemsResource;Service.DeleteResource(p,l.ID,l,function(b){var a=b.result});return true}return false};DataModel.GetSuggestions=function DataModel$GetSuggestions(h,e,f){var g={};if(e==null){e=DataModel.User}g.EntityID=e.ID;g.FieldName=f;g.EntityType=EntityTypes.User;if(e.hasOwnProperty("ItemTypeID")){g.EntityType=(e.hasOwnProperty("FolderID"))?EntityTypes.Item:EntityTypes.Folder}Service.InsertResource(Service.SuggestionsResource,g,function(a){var b=a.result;if(b.length>0){DataModel.SuggestionsRetrieved=new Date()}DataModel.processSuggestions(b);if(h!=null){h(DataModel.Suggestions)}})};DataModel.SelectSuggestion=function DataModel$SelectSuggestion(j,h,g){h=(h==null)?Reasons.Chosen:h;var i=$.extend({},j);i.TimeSelected=DataModel.timeStamp;i.ReasonSelected=h;var f=[j,i];Service.UpdateResource(Service.SuggestionsResource,j.ID,f,function(a){var b=a.result;if(g!=null){g(i)}})};DataModel.RemoveSuggestion=function DataModel$RemoveSuggestion(d){var c=DataModel.Suggestions[d.GroupID];if(c!=null){delete c.Suggestions[d.ID]}};DataModel.fireDataChanged=function(e,g){if(DataModel.UserSettings.GetFolder(e)==null){for(var h in DataModel.onDataChangedHandlers){var f=DataModel.onDataChangedHandlers[h];if(typeof(f)=="function"){f(e,g)}}}};DataModel.getFolder=function(d){var c=DataModel.Folders[d];if(c==null){c=DataModel.UserSettings.GetFolder(d)}return c};DataModel.addFolder=function(d,c){d=Folder.Extend(d);if(d.ItemsMap==null){d.ItemsMap=new ItemMap([]);d.Items=d.ItemsMap.Items}DataModel.FoldersMap.append(d);if(c===undefined){DataModel.fireDataChanged(d.ID)}else{if(c!=null){DataModel.fireDataChanged(c.FolderID,c.ID)}}return d};DataModel.deleteReferences=function(n){for(var h in DataModel.Folders){var i=DataModel.Folders[h];for(var l in i.Items){var m=i.Items[l];if(m.ItemTypeID==ItemTypes.Reference){for(var k in m.FieldValues){var j=m.FieldValues[k];if(j.FieldName==FieldNames.EntityRef&&j.Value==n){m.GetFolder().ItemsMap.remove(m)}}}}}};DataModel.processConstants=function DataModel$processConstants(r){var i={};for(var s in r){i[s]=r[s]}var p=i.ItemTypes;for(var n in p){var o=ItemType.Extend(p[n]);var m={};for(var q in o.Fields){var j=o.Fields[q];j.ClassName="fn-"+j.Name.toLowerCase();j.Class=j.ClassName+" dt-"+j.DisplayType.toLowerCase();m[j.Name]=j}o.Fields=m;p[n]=o}i.ItemTypesMap=new ItemMap(p);i.ItemTypes=i.ItemTypesMap.Items;i.PrioritiesByName={};for(var n in i.Priorities){var t=i.Priorities[n];i.PrioritiesByName[t.Name]=t}DataModel.Constants=i};DataModel.processUserData=function DataModel$processUserData(e){var h={};for(var f in e){h[f]=e[f]}var g={};g.ID=h.ID;g.Name=h.Name;g.Email=h.Email;g.CreateDate=h.CreateDate;DataModel.User=g;DataModel.processFolders(h.Folders)};DataModel.processSuggestions=function DataModel$processSuggestions(t){var x={};var n=[];var r={};var u=0;for(var s in t){var w=t[s];if(w.ParentID==null){var q=w.GroupDisplayName;var p=r[q];if(p===undefined){p=(w.GroupDisplayName==SuggestionTypes.RefreshEntity)?w.GroupDisplayName:"Group_"+(u++).toString();r[q]=p;x[p]={GroupID:p,DisplayName:w.GroupDisplayName,Suggestions:{}}}w.GroupID=p;x[p].Suggestions[w.ID]=w}else{n.push(w)}}for(s in n){var i=n[s];for(p in x){var o=x[p];var v=o.Suggestions[i.ParentID];if(v!=null){if(v.Suggestions==null){v.Suggestions={}}v.Suggestions[i.ID]=i;break}}}DataModel.Suggestions=x};DataModel.processFolders=function DataModel$processFolders(k){var j,p;for(var l in k){k[l]=Folder.Extend(k[l]);var m=k[l].Items;for(var n in m){m[n]=Item.Extend(m[n])}k[l].ItemsMap=new ItemMap(m);k[l].Items=k[l].ItemsMap.Items;if(k[l].Name==SystemFolders.Client){j=l}if(k[l].Name==SystemFolders.WebClient){p=l}}var i=k.splice(j,1)[0];if(p==null){DataModel.UserSettings=new UserSettings(i);Service.InsertResource(Service.FoldersResource,{Name:SystemFolders.WebClient,ItemTypeID:ItemTypes.NameValue,SortOrder:0},function(a){var b=a.result;b=Folder.Extend(b);DataModel.UserSettings=new UserSettings(i,b)})}else{if(p>j){p--}var o=k.splice(p,1)[0];DataModel.UserSettings=new UserSettings(i,o)}DataModel.FoldersMap=new ItemMap(k);DataModel.Folders=DataModel.FoldersMap.Items};DataModel.restoreSelection=function DataModel$restoreSelection(f){if(f===undefined&&DataModel.UserSettings!=null){f=DataModel.UserSettings.ViewState.SelectedItem}if(f!=null){var e=DataModel.FindItem(f);if(e!=null){DataModel.fireDataChanged(e.FolderID,e.ID);return}}var d=DataModel.UserSettings.ViewState.SelectedFolder;if(d!=null){DataModel.fireDataChanged(d);return}DataModel.fireDataChanged()};function Folder(){}Folder.Extend=function Folder$Extend(b){return $.extend(new Folder(),b)};Folder.prototype.Copy=function(){var b=$.extend(new Folder(),this);b.Items={};b.ItemsMap={};return b};Folder.prototype.IsFolder=function(){return true};Folder.prototype.IsDefault=function(){var b=DataModel.UserSettings.GetDefaultList(this.ItemTypeID);if(b!=null){return(b.IsFolder())?(this.ID==b.ID):(this.ID==b.FolderID)}return false};Folder.prototype.IsSelected=function(){return DataModel.UserSettings.IsFolderSelected(this.ID)};Folder.prototype.IsExpanded=function(){return DataModel.UserSettings.IsFolderExpanded(this.ID)};Folder.prototype.Expand=function(b){DataModel.UserSettings.ExpandFolder(this.ID,b)};Folder.prototype.GetItemType=function(){return DataModel.Constants.ItemTypes[this.ItemTypeID]};Folder.prototype.GetItems=function(b){return DataModel.GetItems(this,null,b)};Folder.prototype.GetItem=function(b){return this.Items[b]};Folder.prototype.GetItemByName=function(e,f){for(id in this.Items){var d=this.Items[id];if(d.Name==e){if(f===undefined||d.ParentID==f){return d}}}return null};Folder.prototype.GetItemByValue=function(f,e){for(id in this.Items){var d=this.Items[id];if(d.ItemTypeID==ItemTypes.NameValue||d.ItemTypeID==ItemTypes.Reference){if(f==d.GetFieldValue(FieldNames.Value)&&(e===undefined||d.ParentID==e)){return d}}}return null};Folder.prototype.GetSelectedItem=function(){for(id in this.Items){if(DataModel.UserSettings.IsItemSelected(id)==true){return this.Items[id]}}return null};Folder.prototype.InsertItem=function(h,f,g,e){return DataModel.InsertItem(h,this,f,g,e)};Folder.prototype.Update=function(b){return DataModel.UpdateItem(this,b)};Folder.prototype.Delete=function(){return DataModel.DeleteItem(this)};Folder.prototype.addItem=function(f,d){f=Item.Extend(f);if(this.ItemsMap==null){this.ItemsMap=new ItemMap([f]);this.Items=this.ItemsMap.Items}else{this.ItemsMap.append(f)}if(d===undefined){var e=(f.IsList)?f.ID:f.ID;DataModel.fireDataChanged(this.ID,e)}else{if(d!=null){DataModel.fireDataChanged(d.FolderID,d.ID)}}};Folder.prototype.update=function(b){if(this.ID==b.ID){b=Folder.Extend(b);b.ItemsMap=this.ItemsMap;b.Items=this.ItemsMap.Items;b.FolderUsers=this.FolderUsers;DataModel.FoldersMap.update(b);DataModel.Folders=DataModel.FoldersMap.Items;DataModel.fireDataChanged(this.ID);return true}return false};function Item(){}Item.Extend=function Item$Extend(b){return $.extend(new Item(),b)};Item.prototype.Copy=function(){var d=this.GetFolder();var c=(d==null)?this:d.GetItem(this.ID);return $.extend(true,new Item(),(c==null)?this:c)};Item.prototype.IsFolder=function(){return false};Item.prototype.IsDefault=function(){var b=DataModel.UserSettings.GetDefaultList(this.ItemTypeID);if(b!=null){return(this.ID==b.ID)}return false};Item.prototype.Select=function(){return DataModel.UserSettings.Selection(this.FolderID,this.ID)};Item.prototype.IsSelected=function(b){return DataModel.UserSettings.IsItemSelected(this.ID,b)};Item.prototype.GetFolder=function(){return(DataModel.getFolder(this.FolderID))};Item.prototype.GetParent=function(){return(this.ParentID==null)?null:this.GetFolder().Items[this.ParentID]};Item.prototype.GetParentContainer=function(){return(this.ParentID==null)?this.GetFolder():this.GetParent()};Item.prototype.GetItemType=function(){return DataModel.Constants.ItemTypes[this.ItemTypeID]};Item.prototype.GetItems=function(b){return DataModel.GetItems(this.FolderID,this.ID,b)};Item.prototype.InsertItem=function(h,f,g,e){return DataModel.InsertItem(h,this,f,g,e)};Item.prototype.Update=function(d,c){return DataModel.UpdateItem(this,d,c)};Item.prototype.Delete=function(b){return DataModel.DeleteItem(this,b)};Item.prototype.HasField=function(b){return this.GetItemType().HasField(b)};Item.prototype.GetField=function(b){return this.GetItemType().Fields[b]};Item.prototype.GetFields=function(){return this.GetItemType().Fields};Item.prototype.Refresh=function(){var b=this;Service.GetResource(Service.ItemsResource,this.ID,function(d){var a=d.result;if(a!=null){b.update(a,null)}})};Item.prototype.GetFieldValue=function(f,h){if(typeof(f)=="string"){f=this.GetField(f)}if(f!=null&&this.HasField(f.Name)){if(f.Name==FieldNames.Name){return this.Name}for(var i in this.FieldValues){var g=this.FieldValues[i];if(g.FieldName==f.Name){if(g.Value!=null&&f.FieldType==FieldTypes.Guid){var j=DataModel.FindItem(g.Value);if(j!=null){return j}}if(f.FieldType==FieldTypes.Boolean){if(typeof(g.Value)=="string"){g.Value=(g.Value.toLowerCase()=="true")}}return g.Value}}if(f.FieldType=="Boolean"){return false}return null}return undefined};Item.prototype.SetFieldValue=function(f,j){if(typeof(f)=="string"){f=this.GetField(f)}if(f!=null&&this.HasField(f.Name)){if(f.Name==FieldNames.Name){this.Name=j;return true}if(this.FieldValues==null){this.FieldValues=[]}var i=false;for(var h in this.FieldValues){var g=this.FieldValues[h];if(g.FieldName==f.Name){g.Value=j;i=true;break}}if(!i){this.FieldValues=this.FieldValues.concat({FieldName:f.Name,ItemID:this.ID,Value:j})}return true}return false};Item.prototype.AddReference=function(g,h,k){if(typeof(g)=="string"){g=this.GetField(g)}if(g!=null&&this.HasField(g.Name)&&g.FieldType==FieldTypes.Guid){var j=this.GetFieldValue(g);if(j!=null){if(k==true){return this.replaceReference(j,h)}else{return this.addReference(j,h)}}else{var l=this;var i={Name:g.Name,IsList:true,ItemTypeID:ItemTypes.Reference,FolderID:l.FolderID,ParentID:l.ID,UserID:l.UserID};Service.InsertResource(Service.ItemsResource,i,function(b){var a=b.result;l.addItem(a,null);a=DataModel.FindItem(a.ID);l.addReference(a,h);var c=$.extend({},l);c.SetFieldValue(g.Name,a.ID);l.Update(c)})}return true}return false};Item.prototype.RemoveReferences=function(f){if(typeof(f)=="string"){f=this.GetField(f)}if(f!=null&&this.HasField(f.Name)&&f.FieldType==FieldTypes.Guid){var j=this.GetFieldValue(f);if(j!=null&&j.IsList){var i=j.GetItems();for(var g in i){var h=i[g];h.Delete()}}return true}return false};Item.prototype.addItem=function(d,c){this.GetFolder().addItem(d,c)};Item.prototype.update=function(f,d){if(this.ID==f.ID){f=Item.Extend(f);var e=this.GetFolder();if(this.FolderID==f.FolderID){e.ItemsMap.update(f);e.Items=e.ItemsMap.Items}else{e.ItemsMap.remove(this);f.GetFolder().ItemsMap.append(f)}if(d===undefined){DataModel.fireDataChanged(this.FolderID,this.ID)}else{if(d!=null){DataModel.fireDataChanged(this.FolderID,d.ID)}}return true}return false};Item.prototype.selectNextItem=function(){var h=this.GetParent();var i=(h==null)?this.GetFolder().GetItems():h.GetItems();var f=ItemMap.indexOf(i,this.ID);var g=ItemMap.itemAt(i,f+1);if(g!=null){return g}else{if(f==0){if(h!=null){return h}}else{var j=ItemMap.itemAt(i,f-1);if(j!=null){return j}}}return null};Item.prototype.addReference=function(f,e){if(f.IsList){var d=Item.Extend({Name:e.Name,ItemTypeID:ItemTypes.Reference,FolderID:f.FolderID,ParentID:f.ID,UserID:f.UserID});d.SetFieldValue(FieldNames.EntityRef,e.ID);d.SetFieldValue(FieldNames.EntityType,EntityTypes.Item);f.InsertItem(d,null,null,null);return true}return false};Item.prototype.replaceReference=function(k,j){if(k.IsList){var i=k.GetItems();for(var g in i){var h=i[g];var l=h.Copy();l.SetFieldValue(FieldNames.EntityRef,j.ID);h.Update(l,k.GetParent());return true}return this.addReference(k,j)}return false};function ItemType(){}ItemType.Extend=function ItemType$Extend(b){return $.extend(new ItemType(),b)};ItemType.prototype.HasField=function(b){return(this.Fields.hasOwnProperty(b))};function ItemMap(b){this.array=b;this.updateMap()}ItemMap.prototype.updateMap=function(){this.Items={};for(var b in this.array){if(this.array[b].hasOwnProperty("ID")){this.Items[this.array[b].ID]=this.array[b]}else{throw ItemMap.errorMustHaveID}}};ItemMap.prototype.indexOf=function(d){for(var c in this.array){if(this.array[c].ID==d.ID){return c}}return -1};ItemMap.prototype.itemAt=function(b){if(b<0){return this.array[this.array.length-1]}if(b<this.array.length){return this.array[b]}return null};ItemMap.prototype.append=function(b){if(b.hasOwnProperty("ID")){this.array=this.array.concat(b);this.Items[b.ID]=this.array[this.array.length-1]}else{throw ItemMap.errorMustHaveID}};ItemMap.prototype.update=function(h){if(h.hasOwnProperty("ID")){var g=this.indexOf(h);var e=this.itemAt(g);if(h.hasOwnProperty("SortOrder")&&e.hasOwnProperty("SortOrder")&&(h.SortOrder!=e.SortOrder)){this.array.splice(g,1);for(var f in this.array){if(this.array[f].hasOwnProperty("SortOrder")&&h.SortOrder<this.array[f].SortOrder){this.array.splice(f,0,h);this.updateMap();return}}this.array.push(h);this.updateMap()}else{this.array[g]=h;this.Items[h.ID]=this.array[g]}}else{throw ItemMap.errorMustHaveID}};ItemMap.prototype.remove=function(d){if(d.hasOwnProperty("ID")){var c=this.indexOf(d);if(c>=0){this.array.splice(c,1);delete this.Items[d.ID]}}else{throw ItemMap.errorMustHaveID}};ItemMap.count=function(f){var d=0,e;for(e in f){if(f.hasOwnProperty(e)){d++}}return d};ItemMap.indexOf=function(j,g){var h=-1,f=0;for(var i in j){if(i==g){h=f;break}f++}return h};ItemMap.itemAt=function(h,e){for(var g in h){var f=h[g];if(e--==0){return f}}return(e<0)?f:null};ItemMap.errorMustHaveID="ItemMap requires all items in array to have an ID property.";function LinkArray(b){this.links=[];if(b!=null&&b.length>0){this.links=$.parseJSON(b)}}LinkArray.prototype.Links=function(){return this.links};LinkArray.prototype.ToJson=function(){return JSON.stringify(this.links)};LinkArray.prototype.Remove=function(b){this.links.splice(b,1)};LinkArray.prototype.Add=function(d,e){if(e!=null){this.links.push({Name:e,Url:d});return this.links}var f=d.split(",");if(f.length>1){e=$.trim(f[0]);d=$.trim(f[1]);this.links.push({Name:e,Url:d})}else{this.links.push({Url:d})}return this.links};LinkArray.prototype.ToText=function(){var f="";for(var d in this.links){var e=this.links[d];if(e.hasOwnProperty("Name")){if(e.Name!=null&&e.Name.length>0&&e.Name!=e.Url){f+=e.Name+", "}}f+=e.Url+"\r\n"}return f};LinkArray.prototype.Parse=function(h){var f=h.split(/\r\n|\r|\n/g);for(var e in f){var g=f[e].split(",");if(g.length==1&&g[0].length>0){this.links.push({Url:g[0]})}if(g.length==2){this.links.push({Name:g[0],Url:g[1]})}}};function UserSettings(c,d){this.clientFolder=c;this.webClientFolder=d;this.init(UserSettings.viewStateName,UserSettings.viewStateKey);this.init(UserSettings.preferencesName,UserSettings.preferencesKey)}UserSettings.defaultListsKey="DefaultLists";UserSettings.viewStateName="ViewState";UserSettings.viewStateKey="WebViewState";UserSettings.preferencesName="Preferences";UserSettings.preferencesKey="WebPreferences";UserSettings.prototype.GetFolder=function(b){if(this.clientFolder.ID==b){return this.clientFolder}if(this.webClientFolder.ID==b){return this.webClientFolder}return null};UserSettings.prototype.GetDefaultList=function(i){var g=this.clientFolder.GetItemByName(UserSettings.defaultListsKey);if(g!=null){var f=this.clientFolder.GetItemByValue(i,g.ID);if(f!=null){var j=f.GetFieldValue(FieldNames.EntityRef);if(typeof(j)=="object"){return j}}}var h;for(id in DataModel.Folders){h=DataModel.Folders[id];if(h.ItemTypeID==i){return h}}return h};UserSettings.prototype.Selection=function(c,d){this.ViewState.SelectedFolder=c;this.ViewState.SelectedItem=d};UserSettings.prototype.IsFolderSelected=function(b){return(this.ViewState.SelectedFolder==b)};UserSettings.prototype.IsItemSelected=function(f,d){if(d==true){var e=DataModel.FindItem(this.ViewState.SelectedItem);if(e!=null&&e.ParentID==f){return true}}return(this.ViewState.SelectedItem==f)};UserSettings.prototype.ExpandFolder=function(d,c){if(this.ViewState.ExpandedFolders==null){this.ViewState.ExpandedFolders={}}if(c==true){this.ViewState.ExpandedFolders[d]=true}else{delete this.ViewState.ExpandedFolders[d]}};UserSettings.prototype.IsFolderExpanded=function(b){return(this.ViewState.ExpandedFolders!=null&&this.ViewState.ExpandedFolders[b]==true)};UserSettings.prototype.Save=function(){var c={};for(var d in DataModel.Folders){if(DataModel.Folders[d].IsExpanded()){c[d]=true}}this.ViewState.ExpandedFolders=c;this.update(UserSettings.viewStateName,UserSettings.viewStateKey)};UserSettings.prototype.UpdateTheme=function(b){if(this.Preferences.Theme!=b){this.Preferences.Theme=b;this.update(UserSettings.preferencesName,UserSettings.preferencesKey);Service.ChangeTheme(b)}};UserSettings.prototype.init=function(g,e){var f="item"+g;if(this.webClientFolder!=null){this[f]=this.webClientFolder.GetItemByName(e,null)}if(this[f]==null){this[g]={};if(this.webClientFolder!=null){this.webClientFolder.InsertItem(Item.Extend({Name:e,ItemTypeID:ItemTypes.NameValue}),null,null,null)}}else{var h=this[f].GetFieldValue(FieldNames.Value);this[g]=(h==null)?{}:$.parseJSON(h)}};UserSettings.prototype.update=function(g,e){if(this.webClientFolder!=null){var f="item"+g;if(this[f]==null){this[f]=this.webClientFolder.GetItemByName(e,null)}var h=this[f].Copy();h.SetFieldValue(FieldNames.Value,JSON.stringify(this[g]));this[f].Update(h)}};var ItemTypes={Task:"00000000-0000-0000-0000-000000000001",Location:"00000000-0000-0000-0000-000000000002",Contact:"00000000-0000-0000-0000-000000000003",ListItem:"00000000-0000-0000-0000-000000000004",Grocery:"00000000-0000-0000-0000-000000000005",ShoppingItem:"00000000-0000-0000-0000-000000000008",Appointment:"00000000-0000-0000-0000-000000000009",System:"00000000-0000-0000-0000-000000000000",Reference:"00000000-0000-0000-0000-000000000006",NameValue:"00000000-0000-0000-0000-000000000007"};var FieldNames={Name:"Name",Description:"Description",Priority:"Priority",Complete:"Complete",CompletedOn:"CompletedOn",DueDate:"DueDate",EndDate:"EndDate",Birthday:"Birthday",Address:"Address",WebLink:"WebLink",WebLinks:"WebLinks",Email:"Email",Phone:"Phone",HomePhone:"HomePhone",WorkPhone:"WorkPhone",Amount:"Amount",Cost:"Cost",ItemTags:"ItemTags",EntityRef:"EntityRef",EntityType:"EntityType",Contacts:"Contacts",Locations:"Locations",Value:"Value",Category:"Category",LatLong:"LatLong",FacebookID:"FacebookID",Sources:"Sources",Gender:"Gender",Picture:"Picture"};var EntityTypes={User:"User",Folder:"Folder",Item:"Item"};var FieldTypes={String:"String",Boolean:"Boolean",Integer:"Integer",DateTime:"DateTime",Phone:"Phone",Email:"Email",Url:"Url",Address:"Address",Currency:"Currency",TagIDs:"TagIDs",Guid:"Guid",JSON:"JSON"};var DisplayTypes={Hidden:"Hidden",Text:"Text",TextArea:"TextArea",Checkbox:"Checkbox",DatePicker:"DatePicker",DateTimePicker:"DateTimePicker",Phone:"Phone",Email:"Email",Link:"Link",Currency:"Currency",Address:"Address",Priority:"Priority",TagList:"TagList",Reference:"Reference",Contact:"Contact",ContactList:"ContactList",LocationList:"LocationList",LinkArray:"LinkArray"};var SuggestionTypes={ChooseOne:"ChooseOne",ChooseOneSubject:"ChooseOneSubject",ChooseMany:"ChooseMany",ChooseManyWithChildren:"ChooseManyWithChildren",GetFBConsent:"GetFBConsent",GetGoogleConsent:"GetGoogleConsent",GetADConsent:"GetADConsent",NavigateLink:"NavigateLink",RefreshEntity:"RefreshEntity"};var Reasons={Chosen:"Chosen",Ignore:"Ignore",Like:"Like",Dislike:"Dislike"};var Sources={Directory:"Directory",Facebook:"Facebook",Local:"Local"};var SystemFolders={Client:"$Client",WebClient:"$WebClient"};var SystemUsers={System:"00000000-0000-0000-0000-000000000001",User:"00000000-0000-0000-0000-000000000002"};var Dashboard=function Dashboard$(){this.dataModel=null;this.folderList=null;this.helpManager=null;this.settingsManager=null;this.folderManager=null;this.suggestionList=null;this.suggestionManager=null};Dashboard.Init=function Dashboard$Init(e,f,d){Dashboard.dataModel=e;Dashboard.checkBrowser();Dashboard.checkConsent(d);if(f==true){Service.GetFacebookConsent()}Dashboard.dataModel.AddDataChangedHandler("dashboard",Dashboard.ManageDataChange);Dashboard.$element=$(".dashboard-region");Dashboard.$center=$(".dashboard-center");Dashboard.$left=$(".dashboard-left");Dashboard.$right=$(".dashboard-right");Dashboard.folderList=new FolderList(this.dataModel.Folders);Dashboard.folderList.addSelectionChangedHandler("dashboard",Dashboard.ManageFolder);Dashboard.suggestionList=new SuggestionList();Dashboard.suggestionList.addSelectionChangedHandler("dashboard",Dashboard.ManageChoice);Dashboard.suggestionManager=new SuggestionManager(Dashboard.dataModel);Dashboard.helpManager=new HelpManager(Dashboard,Dashboard.$center);Dashboard.settingsManager=new SettingsManager(Dashboard,Dashboard.$center);Dashboard.folderManager=new FolderManager(Dashboard,Dashboard.$center);Dashboard.folderManager.addSelectionChangedHandler("dashboard",Dashboard.ManageFolder);if(Dashboard.dataModel.UserSettings.ViewState.SelectedFolder!=null){Dashboard.showManager(Dashboard.folderManager);Dashboard.dataModel.restoreSelection()}else{Dashboard.showManager(Dashboard.helpManager)}$(window).bind("load",Dashboard.resize);$(window).bind("resize",Dashboard.resize);$(window).bind("unload",Dashboard.Close);$logo=$(".brand a");$logo.unbind("click");$logo.click(function(){Dashboard.dataModel.Refresh();return false});Dashboard.showHeaderOptions()};Dashboard.Close=function Dashboard$Close(b){$(".header-icons").hide();Dashboard.dataModel.Close()};Dashboard.ManageDataChange=function Dashboard$ManageDataChange(c,d){Dashboard.ManageFolder(c,d);Dashboard.folderList.render(Dashboard.$left,Dashboard.dataModel.Folders)};Dashboard.ManageFolder=function Dashboard$ManageFolder(f,h){var g;var e=(f!=null)?Dashboard.dataModel.Folders[f]:null;if(h==null){Dashboard.dataModel.UserSettings.Selection(f,h);if(e!=null){Dashboard.showManager(Dashboard.folderManager);Dashboard.folderManager.selectFolder(e)}else{Dashboard.showManager(Dashboard.helpManager)}}else{g=(e!=null&&h!=null)?e.Items[h]:null;Dashboard.dataModel.UserSettings.Selection(f,h);Dashboard.showManager(Dashboard.folderManager);Dashboard.folderManager.selectItem(g)}if(!Dashboard.resizing){Dashboard.getSuggestions(e,g)}};Dashboard.ManageChoice=function Dashboard$ManageChoice(j){var i=Dashboard.suggestionManager.select(j);if(i){Dashboard.suggestionList.hideGroup(j.GroupID);Dashboard.suggestionList.working(true);var h=0;var g=new Date();var f=function(){if(g>Dashboard.dataModel.SuggestionsRetrieved&&h++<5){Dashboard.getSuggestions(Dashboard.folderManager.currentFolder,Dashboard.folderManager.currentItem);setTimeout(f,5000)}else{Dashboard.suggestionList.working(false)}};f()}};Dashboard.render=function Dashboard$render(c,d){Dashboard.folderList.render(Dashboard.$left)};Dashboard.showHeaderOptions=function Dashboard$showHeaderOptions(){$dropdown=$(".navbar-fixed-top .pull-right .dropdown-menu");$menuitem=$dropdown.find(".option-refresh");$menuitem.show();$menuitem.click(function(b){Dashboard.dataModel.Refresh();b.preventDefault()});$menuitem=$dropdown.find(".option-settings");$menuitem.show();$menuitem.click(function(b){Dashboard.showManager(Dashboard.settingsManager);b.preventDefault()});$menuitem=$dropdown.find(".option-help");$menuitem.show();$menuitem.click(function(b){Dashboard.showManager(Dashboard.helpManager);b.preventDefault()})};Dashboard.showManager=function Dashboard$showManager(d,c){if(Dashboard.currentManager!=d){Dashboard.currentManager=d;Dashboard.folderManager.hide();Dashboard.settingsManager.hide();Dashboard.helpManager.hide();(d.addWell==true)?Dashboard.$center.addClass("well"):Dashboard.$center.removeClass("well")}d.show(c)};Dashboard.resize=function Dashboard$resize(){if(Dashboard.resizing){return}Dashboard.resizing=true;$(window).unbind("resize",Dashboard.resize);var h=$(window).height();var g=$(".navbar-fixed-top").height();var f=$(".navbar-fixed-bottom").height();var e=h-(g+f+30);Dashboard.$left.height(e);Dashboard.$center.height(e);Dashboard.$right.height(e);Dashboard.showManager(Dashboard.currentManager,true);Dashboard.folderList.render(Dashboard.$left);$(window).bind("resize",Dashboard.resize);Dashboard.resizing=false};Dashboard.checkBrowser=function Dashboard$checkBrowser(){if(Browser.IsMSIE()&&Browser.MSIE_Version()<9){var c="We're Sorry!";var d="This application currently requires an HTML5-compatible browser. We encourage you to try using the application with the latest version of Internet Explorer, Chrome, or FireFox.<br/>Thank you";Control.alert(d,c)}};Dashboard.checkConsent=function Dashboard$checkConsent(d){if(d!=null&&d.length>0){var f,e;switch(d){case"FBConsentFail":e="Failed!";f="This application was not able to receive consent for accessing your Facebook information.";break;case"GoogleConsentFail":e="Failed!";f="This application was not able to receive consent for managing your Google calendar.";break;case"CloudADConsentFail":e="Failed!";f="This application was not able to receive consent for accessing your Cloud Directory.";break;default:Dashboard.consentStatus=d;Dashboard.dataModel.GetSuggestions(Dashboard.completeConsent)}if(f!=null){Control.alert(f,e,function(){Service.NavigateToDashboard()})}}};Dashboard.completeConsent=function Dashboard$completeConsent(j){if(Dashboard.consentStatus!=null&&Dashboard.consentStatus.length>0){var h,g,i;var f=function(d,e){if(d!=null){for(var b in d){var a=d[b].Suggestions;if(a!=null){for(var c in a){if(a[c].SuggestionType==e){return a[c]}}}}}return null};switch(Dashboard.consentStatus){case"FBConsentSuccess":g="Success!";h="This application has successfully received consent for accessing your Facebook information.";i=f(j,SuggestionTypes.GetFBConsent);break;case"GoogleConsentSuccess":g="Success!";h="This application has successfully received consent for managing your Google calendar.";i=f(j,SuggestionTypes.GetGoogleConsent);break;case"CloudADConsentSuccess":g="Success!";h="This application has successfully received consent for accessing your Cloud Directory.";i=f(j,SuggestionTypes.GetADConsent);break}Dashboard.consentStatus=null;if(i!=null&&i.ReasonSelected!=Reasons.Chosen){Dashboard.dataModel.SelectSuggestion(i,Reasons.Chosen);Control.alert(h,g,function(){Service.NavigateToDashboard()})}}};Dashboard.getSuggestions=function Dashboard$getSuggestions(c,d){if(d!=null){if(d.hasOwnProperty("Created")){this.dataModel.GetSuggestions(Dashboard.renderSuggestions,d)}else{Dashboard.renderSuggestions({})}}else{if(c!=null){if(c.hasOwnProperty("Items")){Dashboard.dataModel.GetSuggestions(Dashboard.renderSuggestions,c)}else{Dashboard.renderSuggestions({})}}else{return Dashboard.dataModel.GetSuggestions(Dashboard.renderSuggestions)}}};Dashboard.renderSuggestions=function Dashboard$renderSuggestions(j){var f=j[SuggestionTypes.RefreshEntity];if(f!=null){var h;for(var g in f.Suggestions){var i=f.Suggestions[g];Dashboard.dataModel.SelectSuggestion(i,Reasons.Ignore);if(i.EntityType=="Item"){h=i.EntityID}}delete j[SuggestionTypes.RefreshEntity];Dashboard.dataModel.Refresh(h)}Dashboard.suggestionList.render(Dashboard.$right,j);if(j.Group_0!=null){Dashboard.suggestionList.working(false)}};function FolderList(b){this.onSelectionChangedHandlers={};this.init(b)}FolderList.prototype.init=function(b){this.folders=b;this.$element=null};FolderList.prototype.addSelectionChangedHandler=function(d,c){this.onSelectionChangedHandlers[d]=c};FolderList.prototype.removeSelectionChangedHandler=function(b){this.onSelectionChangedHandlers[b]=undefined};FolderList.prototype.fireSelectionChanged=function(e,g){for(var h in this.onSelectionChangedHandlers){var f=this.onSelectionChangedHandlers[h];if(typeof(f)=="function"){f(e,g)}}};FolderList.prototype.render=function(e,g){if(g!=null){this.init(g)}e.empty();this.$element=$('<ul class="nav nav-pills nav-stacked" />').appendTo(e);Control.List.sortable(this.$element);for(var h in this.folders){var f=this.folders[h];$folder=$("<li><a><strong>&nbsp;"+f.Name+"</strong></a></li>").appendTo(this.$element);$folder.data("control",this);$folder.data("item",f);$folder.click(function(){Control.get(this).folderClicked($(this))});$folder.find("strong").prepend(Control.Icons.forItemType(f));if(f.IsSelected()){this.select($folder,f)}this.renderItems($folder,f)}};FolderList.prototype.renderItems=function(f,g){var j=g.GetItems();$itemList=$('<ul class="itemlist nav nav-pills nav-stacked" />').appendTo(f.parent());Control.List.sortable($itemList);for(var h in j){var i=j[h];if(i.IsList){$item=$("<li><a><span>&nbsp;"+i.Name+"</span></a></li>").appendTo($itemList);$item.data("control",this);$item.data("item",i);$item.click(function(){Control.get(this).itemClicked($(this))});$item.find("span").prepend(Control.Icons.forItemType(i));if(i.IsSelected(true)){this.select($item,i)}}}if(g.IsExpanded()){this.expand(f)}else{this.collapse(f)}};FolderList.prototype.folderClicked=function(c){var d=c.data("item");this.toggle(c);this.select(c,d);this.fireSelectionChanged(d.ID)};FolderList.prototype.itemClicked=function(c){var d=c.data("item");this.select(c,d);this.fireSelectionChanged(d.FolderID,d.ID)};FolderList.prototype.select=function(c,d){this.deselect();c.addClass("active")};FolderList.prototype.deselect=function(){this.$element.find("li").removeClass("active")};FolderList.prototype.expand=function(c){var d=c.data("item");c.addClass("expanded");d.Expand(true);Control.expand(c.next(".itemlist"))};FolderList.prototype.collapse=function(c){var d=c.data("item");c.removeClass("expanded");d.Expand(false);Control.collapse(c.next(".itemlist"))};FolderList.prototype.toggle=function(c){var d=c.hasClass("expanded");if(c.hasClass("active")&&d){this.collapse(c)}else{if(!d){this.expand(c)}}};function FolderManager(d,c){this.parentControl=d;this.$parentElement=c;this.addWell=false;this.$element=null;this.currentFolder=null;this.currentItem=null;this.views={};this.onSelectionChangedHandlers={};this.listEditor=new ListEditor(this);this.itemEditor=new ItemEditor(this);this.propEditor=new PropertyEditor(this)}FolderManager.ListView="fm-list-view";FolderManager.ItemView="fm-item-view";FolderManager.PropertyView="fm-property-view";FolderManager.prototype.addSelectionChangedHandler=function(d,c){this.onSelectionChangedHandlers[d]=c};FolderManager.prototype.removeSelectionChangedHandler=function(b){this.onSelectionChangedHandlers[b]=undefined};FolderManager.prototype.fireSelectionChanged=function(e){for(var f in this.onSelectionChangedHandlers){var d=this.onSelectionChangedHandlers[f];if(typeof(d)=="function"){d(e.FolderID,e.ID);this.activeView(FolderManager.ItemView)}}};FolderManager.prototype.hide=function(){if(this.$element!=null){this.$element.hide()}};FolderManager.prototype.show=function(j){if(this.$element==null){this.$element=$('<div class="manager-folders" />').appendTo(this.$parentElement);var h=$('<ul class="nav nav-tabs" />').appendTo(this.$element);h.data("control",this);var f=$('<li><a data-toggle="tab">List View</a></li>').appendTo(h);f.find("a").attr("href","."+FolderManager.ListView);f=$('<li><a data-toggle="tab"><i class="icon-edit"></i> Item</a></li>').appendTo(h);f.find("a").attr("href","."+FolderManager.ItemView);f=$('<li class="pull-right"><a data-toggle="tab"><i class="icon-cog"></i></a></li>').appendTo(h);f.attr("title","List Settings").tooltip({placement:"bottom"});f.find("a").attr("href","."+FolderManager.PropertyView);var g=$('<div class="tab-content" />').appendTo(this.$element);var i=$('<div class="tab-pane" />').appendTo(g);i.addClass(FolderManager.ListView);this.views[FolderManager.ListView]=i;i=$('<div class="tab-pane" />').appendTo(g);i.addClass(FolderManager.ItemView);this.views[FolderManager.ItemView]=i;i=$('<div class="tab-pane" />').appendTo(g);i.addClass(FolderManager.PropertyView);this.views[FolderManager.PropertyView]=i;$('a[data-toggle="tab"]').on("shown",function(b){var a=$(b.target).parents(".nav-tabs");Control.get(a).viewChanged($(b.target))})}if(j==true){this.render()}this.$element.show()};FolderManager.prototype.render=function(){var h=this.$element.find(".nav-tabs");var g=this.$element.find(".tab-content");h.find("li a:first").empty().append(this.activeListName());var k=this.activeView();var j=this.activeItem();var i=this.views[k];var l=this.$parentElement.outerHeight()-h.outerHeight();if(k==FolderManager.ItemView){if(j==null){k=FolderManager.ListView;this.activeView(k)}else{this.itemEditor.render(i,j,l)}}if(k==FolderManager.ListView){this.listEditor.render(i,this.activeList(),l)}if(k==FolderManager.PropertyView){this.propEditor.render(i,this.activeList(),l)}h.find('a[href=".'+k+'"]').tab("show")};FolderManager.prototype.selectFolder=function(b){this.currentFolder=b;this.currentItem=null;if(this.currentFolder!=null){this.render()}};FolderManager.prototype.selectItem=function(b){this.currentItem=b;if(this.currentItem!=null){this.currentFolder=this.currentItem.GetFolder();this.render()}else{this.selectFolder(this.currentFolder)}};FolderManager.prototype.activeItem=function(){var f=null;if(this.currentItem!=null){if(this.currentItem.IsList){f=this.currentItem}else{return this.currentItem}}else{if(this.currentFolder!=null){f=this.currentFolder}}if(f!=null){var e=f.GetItems();for(var d in e){if(!e[d].IsList){this.currentItem=e[d];this.currentItem.Select();break}}}return null};FolderManager.prototype.activeList=function(){if(this.currentItem!=null){return(this.currentItem.IsList)?this.currentItem:this.currentItem.GetParentContainer()}else{if(this.currentFolder!=null){return this.currentFolder}}return null};FolderManager.prototype.activeListName=function(){var d=this.activeList();if(d!=null){var c=Control.Icons.forItemType(d);return $("<span>&nbsp;"+d.Name+"</span>").prepend(c)}return $("<span>List View</span>")};FolderManager.prototype.activeView=function(d){var c=Control.findParent(this,"dataModel").dataModel;if(d===undefined){return(c.UserSettings.ViewState.ActiveView!=null)?c.UserSettings.ViewState.ActiveView:FolderManager.ListView}else{if(c.UserSettings.ViewState.ActiveView!=d){c.UserSettings.ViewState.ActiveView=d;this.render()}}};FolderManager.prototype.viewChanged=function(b){this.activeView(b.attr("href").substr(1))};function HelpManager(d,c){this.parentControl=d;this.$parentControl=c;this.$element=null}HelpManager.prototype.hide=function(){if(this.$element!=null){this.$element.hide()}};HelpManager.prototype.show=function(){if(this.$element==null){this.$element=$('<div class="manager-help" />').appendTo(this.$parentControl);this.render()}this.$element.show()};HelpManager.prototype.render=function(){var b=$('<div class="hero-unit" />').appendTo(this.$element);b.append("<h1>Zaplify!</h1>");b.append(HelpManager.tagline);b.append('<p><a class="btn btn-primary btn-large">Learn more</a></p>')};HelpManager.tagline="<p>The ultimate tool for managing your digital life. Get connected and get organized. All your information just one click away. Learns about you and provides recommendations. Your own personal assistant!</p>";function SettingsManager(d,c){this.parentControl=d;this.$parentElement=c;this.$element=null;this.addWell=false;this.views={}}SettingsManager.Display="sm-display-settings";SettingsManager.prototype.hide=function(){if(this.$element!=null){this.$element.hide()}};SettingsManager.prototype.show=function(){if(this.$element==null){this.$element=$('<div class="manager-settings" />').appendTo(this.$parentElement);var g=$('<ul class="nav nav-tabs" />').appendTo(this.$element);g.data("control",this);var e=$('<li><a data-toggle="tab"><i class="icon-cogs"></i> User Settings</a></li>').appendTo(g);e.find("a").attr("href","."+SettingsManager.Display);var f=$('<div class="tab-content" />').appendTo(this.$element);var h=$('<div class="tab-pane" />').appendTo(f);h.addClass(SettingsManager.Display);this.views[SettingsManager.Display]=h}this.render();this.$element.show()};SettingsManager.prototype.render=function(){var e=this.$element.find(".nav-tabs");e.find('a[href=".'+SettingsManager.Display+'"]').tab("show");var f=this.views[SettingsManager.Display];f.empty();var d=$('<form class="row-fluid form-vertical" />').appendTo(f);Control.ThemePicker.render(d)};function ListEditor(b){this.parentControl=b;this.$element=null;this.newItemEditor=new NewItemEditor(this);this.listView=new ListView(this)}ListEditor.prototype.render=function(f,h,i){if(this.$element==null){this.$element=f}var g=this.newItemEditor.render(this.$element,h);var j=(g!=null)?g.outerHeight():0;this.listView.render(this.$element,h,i-j-28);g.find(".fn-name").focus()};ListEditor.prototype.selectItem=function(b){this.parentControl.fireSelectionChanged(b)};function NewItemEditor(b){this.parentControl=b;this.$element=null;this.list;this.newItem}NewItemEditor.prototype.render=function(c,d){if(d!=null&&(d.IsFolder()||d.IsList)){if(this.$element==null){this.$element=$('<div class="row-fluid" />').appendTo(c)}this.$element.empty();this.list=d;this.newItem=Item.Extend({Name:"",ItemTypeID:this.list.ItemTypeID});$field=this.renderNameField(this.$element);$field.val("")}return this.$element};NewItemEditor.prototype.renderNameField=function(f){var i=this.newItem.GetFields();var j=i[FieldNames.Name];var g=$('<form class="form-inline"/>').appendTo(f);var h=Control.Text.renderInputNew(g,this.newItem,j,this.list);h.addClass("input-block-level");return h};function ListView(b){this.parentControl=b;this.$element=null;this.list=null}ListView.prototype.hide=function(){if(this.$element!=null){this.$element.hide()}};ListView.prototype.show=function(){if(this.$element!=null){this.$element.show()}};ListView.prototype.render=function(f,i,h){if(i==null){return}if(this.$element==null){this.$element=$('<ul class="nav nav-list" />').appendTo(f);Control.List.sortable(this.$element)}this.hide();this.$element.empty();if(h!=null){this.$element.css("max-height",h)}if(this.renderListItems(i.GetItems(true))>0){this.show();var g=this.$element.find("li.selected");var j=g.offset().top-h+this.$element.scrollTop();if(j>0){this.$element.animate({scrollTop:j},500)}}};ListView.prototype.renderListItems=function(n){var m=0;for(var k in n){var l=n[k];var j=$("<li />").appendTo(this.$element);j.data("control",this);j.data("item",l);if(l.IsSelected()){j.addClass("selected")}var i=$('<a class="form-inline" />').appendTo(j);var h=Control.Icons.deleteBtn(l).appendTo(i);h.addClass("pull-right");this.renderNameField(i,l);j.bind("click",function(a){if($(this).hasClass("ui-sortable-helper")||$(a.srcElement).hasClass("dt-checkbox")||$(a.srcElement).hasClass("dt-email")){return}var b=$(this).data("item");Control.get(this).parentControl.selectItem(b)});this.renderFields(i,l);m++}return m};ListView.prototype.renderNameField=function(e,h){var g=h.GetFields();var f=g[FieldNames.Complete];if(f!=null){Control.Checkbox.render(e,h,f)}var f=g[FieldNames.WebLinks];if(f!=null){e.append(Control.Icons.forMap(h))}e.append(Control.Icons.forSources(h));f=g[FieldNames.Name];Control.Text.renderLabel(e,h,f)};ListView.prototype.renderFields=function(g,k){var h=$("<div />").appendTo(g);var j=k.GetFields();for(var l in j){var i=j[l];this.renderField(h,k,i)}$("<small>&nbsp;</small>").appendTo(h)};ListView.prototype.renderField=function(g,l,k){var h;switch(k.Name){case FieldNames.DueDate:if(l.HasField(FieldNames.EndDate)){var j=l.GetField(FieldNames.EndDate);h=Control.DateTime.renderRange(g,l,k,j,"small")}else{if(l.HasField(FieldNames.Complete)&&l.GetFieldValue(FieldNames.Complete)!=true){h=Control.Text.render(g,l,k,"small","Due on ")}}break;case FieldNames.CompletedOn:if(l.GetFieldValue(FieldNames.Complete)==true){h=Control.Text.render(g,l,k,"small","Completed on ")}break;case FieldNames.Category:h=Control.Text.render(g,l,k,"small");break;case FieldNames.Email:h=Control.Text.renderEmail(g,l,k);break;case FieldNames.Address:var i=l.GetFieldValue(FieldNames.Address);if(i!=l.Name){h=Control.Text.render(g,l,k,"small")}break;default:break}return h};function PropertyEditor(b){this.parentControl=b;this.$element=null;this.list}PropertyEditor.prototype.render=function(j,o,p){this.$element=j.empty();var k=$('<form class="row-fluid form-vertical" />').appendTo(this.$element);k.data("control",this);this.list=o;var n=$('<div class="control-group"><label class="control-label">Name of List</label></div>').appendTo(k);n.addClass("inline-left");var m=$('<input type="text" class="" />').appendTo(n);m.addClass("li-name");m.data("control",this);m.val(this.list.Name);m.change(function(a){Control.get(this).handleChange($(a.srcElement))});m.keypress(function(a){return Control.get(this).handleEnterPress(a)});var l=Control.ItemType.renderDropdown(k,this.list);l.addClass("inline-left");var i=this.renderListActions(k,this.list);i.addClass("inline-left")};PropertyEditor.prototype.updateProperty=function(c){if(c.hasClass("li-name")){var d=this.list.Copy();d.Name=c.val();return d}return null};PropertyEditor.prototype.handleChange=function(c){var d=this.updateProperty(c);if(d!=null){this.list.Update(d)}};PropertyEditor.prototype.handleEnterPress=function(b){if(b.which==13){this.handleChange($(b.srcElement));return false}};PropertyEditor.prototype.renderListActions=function(j,l){var k=$('<div class="control-group"><label class="control-label">&nbsp;</label></div>').appendTo(j);var h=$('<div class="btn-group" />').appendTo(k);var g=$('<a class="btn">Action</a>').appendTo(h);g=$('<a class="btn dropdown-toggle" data-toggle="dropdown"><span class="caret" /></a>').appendTo(h);var i=$('<ul class="dropdown-menu" />').appendTo(h);if(l.IsFolder()){$('<li><a href="newfolder"><i class="icon-align-justify"></i> New List</a></li>').appendTo(i);$('<li><a href="newlist"><i class="icon-list"></i> New Sublist</a></li>').appendTo(i)}else{$('<li><a href="newlist"><i class="icon-align-justify"></i> New List</a></li>').appendTo(i)}if(!l.IsDefault()){$('<li class="divider"></li>').appendTo(i);$('<li><a href="deletelist"><i class="icon-remove-sign"></i> Delete List</a></li>').appendTo(i)}i.click(function(c){var a=$(c.target);var b=a.attr("href");if(b=="newfolder"){var e=Folder.Extend({Name:"New List",ItemTypeID:l.ItemTypeID});DataModel.InsertFolder(e)}if(b=="newlist"){var d=(l.IsFolder())?l:l.GetFolder();var f=Item.Extend({Name:"New List",ItemTypeID:l.ItemTypeID,IsList:true});d.Expand(true);d.InsertItem(f)}if(b=="deletelist"){if(!l.IsDefault()){l.Delete()}}c.preventDefault()});return k};function ItemEditor(b){this.parentControl=b;this.$element=null;this.expanded=true;this.item}ItemEditor.prototype.hide=function(){this.$element.hide()};ItemEditor.prototype.show=function(){this.$element.show()};ItemEditor.prototype.render=function(c,d){if(d!=null&&!(d.IsFolder()||d.IsList)){if(this.$element==null){this.$element=$('<form class="row-fluid form-vertical carousel" />').appendTo(c);this.$element.data("control",this)}this.$element.empty();this.item=d;this.siblings=this.item.GetParentContainer().GetItems(true);this.renderFields(this.$element);if(ItemMap.count(this.siblings)>1){$('<a class="page-turn-control left"><div class="page-turn-prev" /></a>').appendTo(this.$element);$('<a class="page-turn-control right"><div class="page-turn-next" /></a>').appendTo(this.$element);this.$element.find(".page-turn-control").click(function(e){var a=$(e.target);var b=Control.get(a.parents(".carousel").first());b.renderNextItem(a);e.preventDefault()});this.$element.find(".carousel-control").dblclick(function(a){a.preventDefault()})}}};ItemEditor.prototype.renderNextItem=function(f){var i=f.hasClass("page-turn-next");var g=ItemMap.indexOf(this.siblings,this.item.ID);var h=ItemMap.count(this.siblings)-1;if(i){g=(g==h)?0:g+1}else{g=(g==0)?h:g-1}var j=ItemMap.itemAt(this.siblings,g);this.parentControl.fireSelectionChanged(j)};ItemEditor.prototype.renderFields=function(f){this.renderNameField(f);var g=$("<div />").appendTo(f);var i=this.item.GetFields();for(var j in i){var h=i[j];if(h.IsPrimary||this.expanded){this.renderField(g,h)}}};ItemEditor.prototype.renderNameField=function(m){var v="span12";var t=this.item.GetFields();var s=t[FieldNames.Complete];var o=$('<form class="form-inline well"/>').appendTo(m);$controls=$('<div class="span10" />').appendTo(o);if(s!=null){var l=Control.Checkbox.render($controls,this.item,s);l.addClass("inline-left");v="span11"}var n;s=t[FieldNames.Name];if(this.item.ItemTypeID==ItemTypes.Location){n=Control.Text.renderInputAddress($controls,this.item,s)}else{if(this.item.ItemTypeID==ItemTypes.Grocery){n=Control.Text.renderInputGrocery($controls,this.item,s)}else{n=Control.Text.renderInput($controls,this.item,s)}}n.addClass(v);var r=$('<div class="btn-toolbar span12" />').prependTo($controls);Control.Icons.deleteBtn(this.item).appendTo(r);var p=Control.ItemType.renderDropdown(r,this.item,true);p.addClass("pull-right");p.find(".btn").addClass("btn-mini").css("border-style","none");var q=$('<div class="span2 thumbnail" />').appendTo(o);var u=this.item.GetFieldValue(FieldNames.Picture);if(u!=null){$image=$("<img />").appendTo(q);$image.attr("src",u)}return n};ItemEditor.prototype.renderField=function(e,h){if(h.Name==FieldNames.Name||h.Name==FieldNames.Complete){return}var f;var g=$('<div class="control-group"><label class="control-label">'+h.DisplayName+"</label></div>");switch(h.DisplayType){case DisplayTypes.Hidden:case DisplayTypes.Priority:case DisplayTypes.Reference:case DisplayTypes.TagList:break;case DisplayTypes.ContactList:f=Control.ContactList.renderInput(g,this.item,h);break;case DisplayTypes.LocationList:f=Control.LocationList.renderInput(g,this.item,h);break;case DisplayTypes.Address:f=Control.Text.renderInputAddress(g,this.item,h);break;case DisplayTypes.LinkArray:f=Control.LinkArray.render(g,this.item,h);break;case DisplayTypes.DateTimePicker:f=Control.DateTime.renderDateTimePicker(g,this.item,h);break;case DisplayTypes.DatePicker:f=Control.DateTime.renderDatePicker(g,this.item,h);break;case DisplayTypes.TextArea:f=Control.Text.renderTextArea(g,this.item,h);break;case DisplayTypes.Checkbox:f=Control.Checkbox.render(g,this.item,h);break;case DisplayTypes.Text:default:f=Control.Text.renderInput(g,this.item,h);break}if(f!=null){f.addClass("input-block-level");g.appendTo(e)}return f};function SuggestionList(){this.onSelectionChangedHandlers={};this.groups={};this.$element=null}SuggestionList.prototype.addSelectionChangedHandler=function(d,c){this.onSelectionChangedHandlers[d]=c};SuggestionList.prototype.removeSelectionChangedHandler=function(b){this.onSelectionChangedHandlers[b]=undefined};SuggestionList.prototype.fireSelectionChanged=function(f){for(var e in this.onSelectionChangedHandlers){var d=this.onSelectionChangedHandlers[e];if(typeof(d)=="function"){if(f!=null){d(f)}}}};SuggestionList.prototype.working=function(b){if(this.$element!=null){if(b==true){this.$element.prepend('<div class="working"><span /></div>')}else{this.$element.find(".working").remove()}}};SuggestionList.prototype.render=function(f,i){this.groups=i;this.$element=f.empty();for(var j in this.groups){var h=this.groups[j];if(h.Suggestions!={}){var g=$('<ul class="nav nav-pills nav-stacked" />').appendTo(this.$element);g.attr("id",h.GroupID);$('<li class="active"><a><strong>'+h.DisplayName+"</strong></a></li>").appendTo(g);this.renderSuggestions(g,h)}}};SuggestionList.prototype.renderSuggestions=function(f,g){var j=g.Suggestions;for(var h in j){var i=j[h];if(i.SuggestionType==SuggestionTypes.ChooseManyWithChildren){if(ItemMap.count(i.Suggestions)>0){$dropdown=$('<li class="dropdown"><a class="dropdown-toggle" data-toggle="dropdown"><b class="caret"></b>&nbsp;&nbsp;'+i.DisplayName+"</a></li>").appendTo(f);this.renderChildSuggestions($dropdown,i)}}else{this.renderSuggestion(f,i)}}};SuggestionList.prototype.renderChildSuggestions=function(g,k){var i=k.Suggestions;var h=$('<ul class="dropdown-menu pull-right" />').appendTo(g);for(var j in i){var l=i[j];this.renderSuggestion(h,l)}};SuggestionList.prototype.renderSuggestion=function(d,f){$suggestion=$("<li><a>"+f.DisplayName+"</a></li>").appendTo(d);$suggestion.data("control",this);$suggestion.data("suggestion",f);$suggestion.click(function(){Control.get(this).suggestionClicked($(this))});if(f.SuggestionType==SuggestionTypes.ChooseOneSubject){var e=Item.Extend($.parseJSON(f.Value));$icons=Control.Icons.forSources(e).addClass("pull-right");$suggestion.find("a").append($icons)}};SuggestionList.prototype.suggestionClicked=function(c){var d=c.data("suggestion");this.fireSelectionChanged(d)};SuggestionList.prototype.hideGroup=function(b){$("#"+b).collapse("hide")};function SuggestionManager(b){this.dataModel=b}SuggestionManager.prototype.select=function(d){var c=false;switch(d.SuggestionType){case SuggestionTypes.ChooseOne:c=this.chooseSuggestion(d);break;case SuggestionTypes.ChooseOneSubject:c=this.chooseSuggestion(d);break;case SuggestionTypes.ChooseMany:c=this.chooseMany(d);break;case SuggestionTypes.NavigateLink:c=this.navigateLink(d);break;case SuggestionTypes.GetFBConsent:c=this.getFacebookConsent(d);break;case SuggestionTypes.GetGoogleConsent:c=this.getGoogleConsent(d);break;case SuggestionTypes.GetADConsent:c=this.getCloudADConsent(d);break;default:c=this.chooseSuggestion(d);break}return c};SuggestionManager.prototype.chooseSuggestion=function(f,d){var e=this.dataModel;e.SelectSuggestion(f,Reasons.Chosen,function(a){if(d!=null){d()}});this.ignoreSuggestions(f);return true};SuggestionManager.prototype.ignoreSuggestions=function(j){var f=this.dataModel;var g=f.Suggestions[j.GroupID];if(g!=null){for(var h in g.Suggestions){var i=g.Suggestions[h];if(i.ID!=j.ID){f.SelectSuggestion(i,Reasons.Ignore)}}}};SuggestionManager.prototype.likeSuggestion=function(d,c){this.dataModel.SelectSuggestion(d,Reasons.Like,function(a){if(c!=null){c()}});return false};SuggestionManager.prototype.dislikeSuggestion=function(f,d){var e=this.dataModel;e.SelectSuggestion(f,Reasons.Dislike,function(a){if(d!=null){d()}});return false};SuggestionManager.prototype.navigateLink=function(b){return this.likeSuggestion(b,function(){window.open(b.Value)})};SuggestionManager.prototype.chooseMany=function(b){return this.likeSuggestion(b,function(){})};SuggestionManager.prototype.getFacebookConsent=function(f){var d=this.dataModel;var e="You will be redirected to Facebook to allow this application to access your Facebook information. This application will use information about yourself to help setup your user profile. This application will use information about your friends to help manage your Contacts. <br><br>Do you want to continue?";Control.confirm(e,"Facebook Consent?",function(){Service.GetFacebookConsent()});return false};SuggestionManager.prototype.getCloudADConsent=function(f){var d=this.dataModel;var e="You will be redirected to the Cloud Directory portal. Login with your Office 365 credentials to allow this application to access your directory information. This application will use information about yourself and other users to help manage your Contacts. <br><br>Do you want to continue?";Control.confirm(e,"Cloud Directory Consent?",function(){Service.GetCloudADConsent()});return false};SuggestionManager.prototype.getGoogleConsent=function(f){var d=this.dataModel;var e="You will be redirected to Google to allow this application to manage your Google Calendar. This application will interact with your calendar to keep your tasks and appointments synchronized. <br><br>Do you want to continue?";Control.confirm(e,"Google Calendar Consent?",function(){Service.GetGoogleConsent()});return false};